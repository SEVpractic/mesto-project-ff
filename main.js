(()=>{"use strict";function e(e,n,r,o,c){var u=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),i=u.querySelector(".card__image"),a=u.querySelector(".card__title"),l=u.querySelector(".card__delete-button"),s=u.querySelector(".card__like-button");return i.src=n.link||"",a.textContent=n.name||"",t(u,n,e),n.owner._id===e?l.addEventListener("click",(function(){return r(u,n._id)})):l.remove(),s.addEventListener("click",(function(){return o(u,n).then((function(e){return n=e}))})),c(i,a),u}function t(e,t,n){var r=e.querySelector(".card__like-button");e.querySelector(".card__like-count").textContent=t.likes.length,t.likes.some((function(e){return e._id===n}))?r.classList.add("card__like-button_is-active"):r.classList.remove("card__like-button_is-active")}function n(e){e.addEventListener("click",o),document.addEventListener("keydown",c),e.classList.remove("popup_is-animated"),e.classList.add("popup_is-opened")}function r(e){e.classList.remove("popup_is-opened"),e.classList.add("popup_is-animated"),e.removeEventListener("click",o),document.removeEventListener("keydown",c)}function o(e){(e.target===e.currentTarget||e.target.classList.contains("popup__close"))&&r(e.currentTarget)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function u(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}function i(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))}function a(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){u(e,n,t)})),i(n,r,t)}var l="https://nomoreparties.co/v1/wff-cohort-36",s={authorization:"61d5fff1-2f3d-4042-8577-25fe07acbd29","Content-Type":"application/json"};function p(e,t,n,r){return fetch(e,{method:t,headers:n,body:JSON.stringify(r)}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).catch((function(e){console.log(e)}))}var d,_=document.querySelector(".places__list"),f=document.querySelector(".profile__image"),m=document.querySelector(".profile__title"),v=document.querySelector(".profile__description"),y=document.querySelector(".popup_type_edit"),S=document.querySelector('.popup__form[name="edit-profile"]'),q=S.querySelector(".popup__input_type_name"),E=S.querySelector(".popup__input_type_description"),b=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),C=document.querySelector(".popup_type_new-card"),k=document.querySelector('.popup__form[name="new-place"]'),g=k.querySelector(".popup__input_type_card-name"),h=k.querySelector(".popup__input_type_url"),x=document.querySelector(".popup_type_image"),T=x.querySelector(".popup__image"),A=x.querySelector(".popup__caption"),w=document.querySelector(".popup_type_image-edit"),B=document.querySelector('.popup__form[name="image-edit"]'),D=B.querySelector(".popup__input_type_url"),P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_visible"};function M(e,t){e.addEventListener("click",(function(r){r.preventDefault(),T.src=e.src,A.textContent=t.textContent,n(x)}))}function j(e,t){(function(e){return p("".concat(l,"/cards/").concat(e),"DELETE",s)})(t).then((function(t){var n;(n=e)&&n.remove()}))}function I(e,n){return n.likes.some((function(e){return e._id===d}))?(r=n._id,p("".concat(l,"/cards/likes/").concat(r),"DELETE",s)).then((function(n){return t(e,n,d),n})):function(e){return p("".concat(l,"/cards/likes/").concat(e),"PUT",s)}(n._id).then((function(n){return t(e,n,d),n}));var r}function G(e,t){var n=e.querySelector('button[type="submit"]');n&&(n.textContent=t?"Сохранение...":"Сохранить")}Promise.all([p("".concat(l,"/users/me"),"GET",s),p("".concat(l,"/cards"),"GET",s)]).then((function(t){d=t[0]._id,m.textContent=t[0].name,v.textContent=t[0].about,f.style.backgroundImage="url('".concat(t[0].avatar,"')"),t[1].forEach((function(t){_.append(e(d,t,j,I,M))}))})),b.addEventListener("click",(function(){S.reset(),q.value=m.textContent,E.value=v.textContent,a(S,P),n(y)})),S.addEventListener("submit",(function(e){var t,n;e.preventDefault(),G(S,!0),(t=q.value,n=E.value,p("".concat(l,"/users/me"),"PATCH",s,{name:t,about:n})).then((function(e){m.textContent=e.name,v.textContent=e.about})).finally((function(e){return G(S,!1)})),r(y)})),L.addEventListener("click",(function(e){k.reset(),a(k,P),n(C)})),k.addEventListener("submit",(function(t){var n,o;t.preventDefault(),G(S,!0),(n=g.value,o=h.value,p("".concat(l,"/cards"),"POST",s,{name:n,link:o})).then((function(t){_.prepend(e(d,t,j,I,M))})).finally((function(e){return G(S,!1)})),r(C)})),f.addEventListener("click",(function(e){B.reset();var t=getComputedStyle(f).backgroundImage;D.value=t.replace(/url\(["']?(.*?)["']?\)/,"$1"),a(B,P),n(w)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),G(S,!0),(t=D.value,p("".concat(l,"/users/me/avatar"),"PATCH",s,{avatar:t})).then((function(e){f.style.backgroundImage="url('".concat(e.avatar,"')")})).finally((function(e){return G(S,!1)})),r(w)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch&&t.dataset.patternErrorMessage?t.setCustomValidity(t.dataset.patternErrorMessage):t.setCustomValidity(""),t.validity.valid?u(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,o,t),i(n,r,t)}))}))}(t,e)}))}(P)})();